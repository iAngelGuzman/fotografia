@model IEnumerable<MoFoto>
@{
    ViewData["Title"] = "Estudiantes";
}
<link rel="stylesheet" href="~/css/Estilos/cssEstudiante.css" asp-append-version="true" />

<div class="container-fluid col-12 col-md-9 col-xl-6 mx-auto">
    <div class="d-flex align-items-center mt-4">
        <a asp-controller="Inicio" asp-action="Index" class="btn btn-secondary btn-sm me-3 px-2 py-1">
            <i class="fa-solid fa-arrow-left-long"></i>
        </a>
        <h2 class="mb-1">Estudiantes</h2>
    </div>
    <div class="d-flex flex-wrap mt-4 gap-2">
        <div class="col-4 col-md-3 order-1 order-md-0">
            <div class="input-group">
                <label class="input-group-text" for="rowsSelector">Ver:</label>
                <select id="ddlEstudiante" class="form-select">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
        </div>
        <div class="col-12 col-md-6 mx-auto order-0 order-md-1">
            <input id="txtBuscarEstudiante" type="text" class="form-control col-10" placeholder="Escriba el nombre de un elemento" aria-label="Buscar catálogo" />
        </div>
        <button id="btnAgregar" class="btn btn-primary btn-md ms-auto order-2" onclick="fnMostrarAgregarImagen()" data-bs-toggle="tooltip" title="Agregar">
            <i class="fa-solid fa-circle-plus"></i>
            <span class="ms-1">Nuevo</span>
        </button>
    </div>
    <div class="table-responsive mt-2">
        <table id="tblEstudiante" class="table table-bordered table-striped text-center">
            <thead class="text-center">
                <tr>
                    <th class="text-center border-0" scope="col">Matrícula</th>
                    <th class="text-center border-0" scope="col">Última modificación</th>
                    <th class="text-center border-0" scope="col">Responsable</th>
                    <th class="text-center border-0" scope="col">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var estudiante in Model)
                {
                    <tr>
                        <td>@estudiante.SMatricula</td>
                        <td>@estudiante.DFUltModif</td>
                        <td>@estudiante.SUsrResp</td>
                        <td>
                            <button id="btnVer" class="btn btn-sm btn-outline-primary fs-6 px-1 py-0 border-0 rounded-2"
                                    data-bs-toggle="tooltip" title="Ver" onclick="fnMostrarVerImagen('@estudiante.SMatricula', '@estudiante.SFoto')">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                            <button id="btnEditar" class="btn btn-sm btn-outline-secondary fs-6 px-1 py-0 border-0 rounded-2"
                                    data-bs-toggle="tooltip" title="Editar" onclick="fnMostrarEditarImagen('@estudiante')">
                                <i class="fa-solid fa-pencil"></i>
                            </button>
                            <button id="btnEliminar" class="btn btn-sm btn-outline-danger fs-6 px-1 py-0 border-0 rounded-2"
                                    data-bs-toggle="tooltip" title="Eliminar" onclick="fnMostrarEliminarImagen()">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- modal -->
<div class="modal fade" id="mdlAgregar" tabindex="-1" aria-labelledby="hAgregar" aria-hidden="true"
     data-bs-keyboard="false" data-bs-backdrop="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="formAgregarFotos" method="post">
                @Html.AntiForgeryToken()
                <!-- input de imagen, solo acepta jpg -->
                <input multiple type="file" id="txtImagenes" accept=".jpg" class="d-none"
                       onchange="fnSubirFotoSeleccionada(this)">

                <div id="divSoltarImagen"
                     class="position-absolute align-items-center justify-content-center bg-secondary bg-opacity-50 text-white fs-4"
                     style="display: none; inset: 0; z-index: 1000;">
                    Suelte las imágenes aquí...
                </div>
                <div class="modal-header">
                    <h5 class="modal-title" id="hAgregar">Estudiante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="divInfo" class="text-center" style="cursor: pointer;" onclick="fnSubirFotoAContenedor()">
                        <div class="m-auto">
                            <div class="card m-auto text-dark border-dark opacity-50"
                                 style="width: 160px; height: 160px;">
                                <i class="fa-solid fa-user m-auto" style="font-size: 100px;"></i>
                            </div>
                        </div>
                        <div class="mt-2 opacity-75">
                            <p class="fw-bold mb-1">Suba sus imágenes</p>
                            <p class="mb-1">Puede seleccionar una o más imágenes para subir.</p>
                            <p class="mb-1">Arrastre y suelte las imágenes aquí,</p>
                            <p class="mb-1">o haga clic en este recuadro para seleccionarlas.</p>
                            <hr class="mt-3 mb-2 opacity-25">
                            <p class="mb-1"><strong>Formato permitido:</strong> JPG</p>
                            <p class="mb-1"><strong>Nombre de archivo:</strong> [MATRICULA].jpg</p>
                            <p class="mb-1"><strong>Ejemplo:</strong> S23021478.jpg</p>
                        </div>
                    </div>
                    <div id="divContenedorFotos" class="text-center d-none">
                        <div class="ratio ratio-1x1 m-auto" style="max-width: 300px;">
                            <img id="imgPrincipal" src="https://picsum.photos/id/10/500/300" alt="foto"
                                 class="img-fluid">
                        </div>
                        <div class="mt-3 d-flex justify-content-center align-items-center gap-2">
                            <span id="spFotoPrincipal" class="align-middle">MATRICULA</span>
                            <button id="btnEditarNombre" type="button" class="btn btn-link p-0 align-middle"
                                    title="Editar nombre">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <input id="txtFotoPrincipal" type="text"
                                   class="form-control form-control-sm d-none align-middle" style="width: 220px;">
                            <div class="d-flex gap-1">
                                <button id="btnGuardarNombre" type="button"
                                        class="btn btn-success btn-sm rounded-circle d-none" title="Guardar">
                                    <i class="fa-solid fa-check"></i>
                                </button>
                                <button id="btnCancelarNombre" type="button"
                                        class="btn btn-danger btn-sm rounded-circle d-none" title="Cancelar">
                                    <i class="fa-solid fa-xmark"></i>
                                </button>
                            </div>
                        </div>
                        <div id="divFotos" class="d-flex flex-wrap gap-1 mt-4">
                            <!-- <button class="ratio ratio-1x1 btn overflow-hidden rounded-0" style="width: 60px; height: 60px; min-width: 60px; min-height: 60px;" onclick="fnMostrarPrincipal(this)">
                                <img src="https://picsum.photos/id/10/200/100" alt="foto" class="img-fluid">
                            </button> -->
                            <!-- boton para subir foto -->
                            <div id="divSubirFoto" class="d-flex align-items-center"
                                 style="max-width: 60px; max-height: 60px; min-width: 60px; min-height: 60px; padding: .7rem;">
                                <button class="btn btn-primary p-0 w-100 h-100 rounded-circle"
                                        onclick="fnSubirFotos()">
                                    <i class="fa-solid fa-plus fs-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="modal-footer d-none">
                <div class="d-flex w-100 gap-2">
                    <button type="button" class="btn btn-danger w-100"
                            data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="button" onclick="fnGuardarFotos()" class="btn btn-success w-100">Guardar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmación para cerrar -->
<div class="modal fade" id="mdlConfirmarCerrar" tabindex="-1" aria-labelledby="hConfirmarCerrar"
     aria-hidden="true" data-bs-backdrop="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hConfirmarCerrar">¿Cerrar y descartar imágenes?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                Si cierras la ventana, se perderán las imágenes seleccionadas. ¿Deseas continuar?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No, volver</button>
                <button type="button" class="btn btn-danger" id="btnConfirmarCerrar">Sí, cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para imágenes duplicadas -->
<div class="modal fade" id="mdlImagenDuplicada" tabindex="-1" aria-labelledby="hImagenDuplicada"
     aria-hidden="true" data-bs-backdrop="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hImagenDuplicada">Imagen duplicada</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-center">
                <p>Ya existe una imagen llamada <span class="fw-bold" id="spNombreImagenDuplicada"></span>.</p>
                <div class="d-flex justify-content-center align-items-center gap-3 mb-3">
                    <div>
                        <div class="small text-muted">Actual</div>
                        <img id="imgDuplicadaActual" src="" alt="Actual"
                             style="min-width: 120px; max-width: 120px; min-height: 120px; max-height: 120px;">
                    </div>
                    <div>
                        <div class="small text-muted">Nueva</div>
                        <img id="imgDuplicadaNueva" src="" alt="Nueva"
                             style="min-width: 120px; max-width: 120px; min-height: 120px; max-height: 120px;">
                    </div>
                </div>
                <p class="mb-1">¿Qué deseas hacer?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="btnReemplazar">Reemplazar</button>
                <button type="button" class="btn btn-secondary" id="btnOmitir">Omitir</button>
                <button type="button" class="btn btn-outline-secondary" id="btnCancelarCarga">Cancelar todo</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para nombre duplicado al editar -->
<div class="modal fade" id="mdlNombreDuplicado" tabindex="-1" aria-labelledby="hNombreDuplicado"
     aria-hidden="true" data-bs-backdrop="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hNombreDuplicado">Nombre duplicado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-center">
                <span>Ya existe una imagen con el nombre <span class="fw-bold" id="spNombreDuplicado"></span>.</span>
                <span class="d-inline-block mt-1">Por favor, elige otro nombre.</span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para visualizar la foto del estudiante -->
<div class="modal fade" id="mdlVerFoto" tabindex="-1" aria-labelledby="hVerFoto" aria-hidden="true" data-bs-backdrop="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hVerFoto">Fotografía del estudiante</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-center">
                <img id="imgVerFoto" src="" alt="Foto del estudiante" class="img-fluid w-100 h-100 rounded border" />
                <div class="mt-2">
                    <span id="spMatriculaVerFoto" class="fw-bold"></span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!-- modal -->
<div class="modal fade" id="mdlEditar" tabindex="-1" aria-labelledby="hEditar" aria-hidden="true"
     data-bs-keyboard="false" data-bs-backdrop="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="formEditarFoto" method="post">
                @Html.AntiForgeryToken()
                <!-- input de imagen, solo acepta jpg -->
                <input multiple type="file" id="txtImagenes" accept=".jpg" class="d-none"
                       onchange="fnSubirFotoSeleccionada(this)">

                <div id="divSoltarImagen"
                     class="position-absolute align-items-center justify-content-center bg-secondary bg-opacity-50 text-white fs-4"
                     style="display: none; inset: 0; z-index: 1000;">
                    Suelte las imágenes aquí...
                </div>
                <div class="modal-header">
                    <h5 class="modal-title" id="hAgregar">Estudiante</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="divInfo" class="text-center d-none" style="cursor: pointer;" onclick="fnSubirFoto()">
                        <div class="m-auto">
                            <div class="card m-auto text-dark border-dark opacity-50"
                                 style="width: 160px; height: 160px;">
                                <i class="fa-solid fa-user m-auto" style="font-size: 100px;"></i>
                            </div>
                        </div>
                        <div class="mt-2 opacity-75">
                            <p class="fw-bold mb-1">Suba sus imágenes</p>
                            <p class="mb-1">Puede seleccionar una o más imágenes para subir.</p>
                            <p class="mb-1">Arrastre y suelte las imágenes aquí,</p>
                            <p class="mb-1">o haga clic en este recuadro para seleccionarlas.</p>
                            <hr class="mt-3 mb-2 opacity-25">
                            <p class="mb-1"><strong>Formato permitido:</strong> JPG</p>
                            <p class="mb-1"><strong>Nombre de archivo:</strong> [MATRICULA].jpg</p>
                            <p class="mb-1"><strong>Ejemplo:</strong> S23021478.jpg</p>
                        </div>
                    </div>

                    <!-- Imagen Principal -->
                    <div class="ratio ratio-1x1 m-auto" style="max-width: 300px; cursor: pointer;" onclick="document.getElementById('txtImagenEditar').click()">
                        <img id="imgEditarPrincipal" src="https://picsum.photos/id/10/500/300" alt="Foto" />
                    </div>

                    <!-- Matricula editable -->
                    <div class="mt-3">
                        <label for="txtMatriculaEditar" class="form-label">Matrícula</label>
                        <input type="text" id="txtMatriculaEditar" class="form-control" />
                    </div>
                </div>
            </form>
            <div class="modal-footer d-none">
                <div class="d-flex w-100 gap-2">
                    <button type="button" class="btn btn-danger w-100"
                            data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="button" onclick="fnActualizarFoto()" class="btn btn-success w-100">Guardar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/js/Scripts/jsEstudiante.js" asp-append-version="true"></script>
<script src="~/js/Scripts/jsFotografia.js" asp-append-version="true"></script>
